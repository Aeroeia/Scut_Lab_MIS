{
  "openapi": "3.0.0",
  "info": {
    "title": "SCUT School of Computer Science Course & Grade Management System API",
    "description": "API文档 - 统计模块",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "/api",
      "description": "API服务器"
    }
  ],
  "paths": {
    "/statistics/dashboard": {
      "get": {
        "summary": "获取Dashboard统计数据",
        "description": "获取系统概览统计数据，包括学生总数、课程总数和平均分数",
        "tags": ["统计"],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/DashboardStats"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "studentCount": 1500,
                    "courseCount": 120,
                    "averageScore": 82.6
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/statistics/student/{studentId}": {
      "get": {
        "summary": "获取学生平均成绩",
        "description": "根据学生ID获取该学生的平均成绩统计数据",
        "tags": ["统计"],
        "parameters": [
          {
            "name": "studentId",
            "in": "path",
            "required": true,
            "description": "学生ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "semester",
            "in": "query",
            "description": "学期",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "academicYear",
            "in": "query",
            "description": "学年",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/StudentStats"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "studentId": "2020XXXX",
                    "studentName": "张三",
                    "averageScore": 85.5,
                    "courseScores": [
                      {
                        "courseName": "高等数学",
                        "courseId": "MATH101",
                        "score": 90
                      },
                      {
                        "courseName": "数据结构",
                        "courseId": "CS201",
                        "score": 85
                      }
                    ],
                    "totalCourses": 10,
                    "scoreDistribution": {
                      "excellent": 5,
                      "good": 3,
                      "average": 2,
                      "poor": 0
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "未找到学生",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "未找到该学生"
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/statistics/class/{className}": {
      "get": {
        "summary": "获取班级平均成绩",
        "description": "根据班级名称获取该班级的平均成绩统计数据",
        "tags": ["统计"],
        "parameters": [
          {
            "name": "className",
            "in": "path",
            "required": true,
            "description": "班级名称",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "semester",
            "in": "query",
            "description": "学期",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "academicYear",
            "in": "query",
            "description": "学年",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "courseId",
            "in": "query",
            "description": "课程ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/ClassStats"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "className": "计算机科学与技术2020级1班",
                    "averageScore": 83.2,
                    "studentCount": 40,
                    "topStudents": [
                      {
                        "studentId": "2020XXXX",
                        "studentName": "李四",
                        "averageScore": 92.5
                      },
                      {
                        "studentId": "2020YYYY",
                        "studentName": "王五",
                        "averageScore": 91.8
                      }
                    ],
                    "courseAverages": [
                      {
                        "courseName": "计算机网络",
                        "courseId": "CS301",
                        "averageScore": 84.5
                      },
                      {
                        "courseName": "操作系统",
                        "courseId": "CS302",
                        "averageScore": 82.1
                      }
                    ],
                    "scoreDistribution": {
                      "excellent": 12,
                      "good": 18,
                      "average": 8,
                      "poor": 2
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "未找到班级",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "未找到该班级"
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/statistics/course/{courseId}": {
      "get": {
        "summary": "获取课程平均成绩",
        "description": "根据课程ID获取该课程的平均成绩统计数据",
        "tags": ["统计"],
        "parameters": [
          {
            "name": "courseId",
            "in": "path",
            "required": true,
            "description": "课程ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "semester",
            "in": "query",
            "description": "学期",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "academicYear",
            "in": "query",
            "description": "学年",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "className",
            "in": "query",
            "description": "班级名称",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/CourseStats"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "courseId": "CS201",
                    "courseName": "数据结构",
                    "averageScore": 78.6,
                    "studentCount": 120,
                    "teacherName": "赵教授",
                    "highestScore": 98,
                    "lowestScore": 45,
                    "passingRate": 92.5,
                    "classAverages": [
                      {
                        "className": "计算机科学与技术2020级1班",
                        "averageScore": 80.2
                      },
                      {
                        "className": "计算机科学与技术2020级2班",
                        "averageScore": 77.3
                      }
                    ],
                    "scoreDistribution": {
                      "excellent": 25,
                      "good": 45,
                      "average": 35,
                      "poor": 15
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "未找到课程",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                },
                "example": {
                  "code": 404,
                  "message": "未找到该课程"
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/statistics/students": {
      "get": {
        "summary": "获取所有学生平均成绩",
        "description": "获取所有学生的平均成绩统计数据",
        "tags": ["统计"],
        "parameters": [
          {
            "name": "semester",
            "in": "query",
            "description": "学期",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "academicYear",
            "in": "query",
            "description": "学年",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "className",
            "in": "query",
            "description": "班级名称",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "pageSize",
            "in": "query",
            "description": "每页数量",
            "schema": {
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sortBy",
            "in": "query",
            "description": "排序字段",
            "schema": {
              "type": "string",
              "enum": ["averageScore", "studentId", "studentName"]
            }
          },
          {
            "name": "sortOrder",
            "in": "query",
            "description": "排序方式",
            "schema": {
              "type": "string",
              "enum": ["asc", "desc"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/AllStudentsStats"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "total": 1500,
                    "page": 1,
                    "pageSize": 10,
                    "students": [
                      {
                        "studentId": "2020XXXX",
                        "studentName": "张三",
                        "className": "计算机科学与技术2020级1班",
                        "averageScore": 88.5
                      },
                      {
                        "studentId": "2020YYYY",
                        "studentName": "李四",
                        "className": "计算机科学与技术2020级2班",
                        "averageScore": 86.3
                      }
                    ],
                    "schoolAverageScore": 82.6,
                    "scoreDistribution": {
                      "excellent": 480,
                      "good": 680,
                      "average": 290,
                      "poor": 50
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/statistics/all": {
      "get": {
        "summary": "获取所有统计数据",
        "description": "获取系统所有统计数据的综合信息",
        "tags": ["统计"],
        "parameters": [
          {
            "name": "semester",
            "in": "query",
            "description": "学期",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "academicYear",
            "in": "query",
            "description": "学年",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "操作成功",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    { "$ref": "#/components/schemas/ApiResponse" },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "$ref": "#/components/schemas/AllStatistics"
                        }
                      }
                    }
                  ]
                },
                "example": {
                  "code": 200,
                  "message": "操作成功",
                  "data": {
                    "studentCount": 1500,
                    "courseCount": 120,
                    "teacherCount": 80,
                    "classCount": 40,
                    "overallAverageScore": 82.6,
                    "courseStatistics": {
                      "highestAverageCourse": {
                        "courseId": "CS401",
                        "courseName": "软件工程",
                        "averageScore": 89.3
                      },
                      "lowestAverageCourse": {
                        "courseId": "MATH201",
                        "courseName": "高等数学II",
                        "averageScore": 72.1
                      }
                    },
                    "classStatistics": {
                      "highestAverageClass": {
                        "className": "软件工程2019级3班",
                        "averageScore": 87.2
                      },
                      "lowestAverageClass": {
                        "className": "网络工程2020级2班",
                        "averageScore": 75.8
                      }
                    },
                    "scoreDistribution": {
                      "excellent": 480,
                      "good": 680,
                      "average": 290,
                      "poor": 50
                    },
                    "yearlyTrend": [
                      {
                        "year": "2018-2019",
                        "averageScore": 81.2
                      },
                      {
                        "year": "2019-2020",
                        "averageScore": 82.1
                      },
                      {
                        "year": "2020-2021",
                        "averageScore": 82.6
                      }
                    ]
                  }
                }
              }
            }
          },
          "500": {
            "description": "服务器错误",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "ApiResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "响应状态码",
            "example": 200
          },
          "message": {
            "type": "string",
            "description": "响应消息",
            "example": "操作成功"
          },
          "data": {
            "type": "object",
            "description": "响应数据"
          }
        }
      },
      "ApiErrorResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "description": "错误状态码",
            "example": 500
          },
          "message": {
            "type": "string",
            "description": "错误消息",
            "example": "服务器内部错误"
          }
        }
      },
      "ScoreDistribution": {
        "type": "object",
        "description": "分数分布统计",
        "properties": {
          "excellent": {
            "type": "integer",
            "description": "优秀成绩数量（90分以上）",
            "example": 12
          },
          "good": {
            "type": "integer",
            "description": "良好成绩数量（80-89分）",
            "example": 18
          },
          "average": {
            "type": "integer",
            "description": "中等成绩数量（70-79分）",
            "example": 8
          },
          "poor": {
            "type": "integer",
            "description": "较差成绩数量（60分以下）",
            "example": 2
          }
        }
      },
      "CourseScore": {
        "type": "object",
        "description": "课程成绩信息",
        "properties": {
          "courseId": {
            "type": "string",
            "description": "课程ID",
            "example": "CS201"
          },
          "courseName": {
            "type": "string",
            "description": "课程名称",
            "example": "数据结构"
          },
          "score": {
            "type": "number",
            "format": "float",
            "description": "课程成绩",
            "example": 85
          }
        }
      },
      "StudentBrief": {
        "type": "object",
        "description": "学生简要信息",
        "properties": {
          "studentId": {
            "type": "string",
            "description": "学生ID",
            "example": "2020XXXX"
          },
          "studentName": {
            "type": "string",
            "description": "学生姓名",
            "example": "张三"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 88.5
          }
        }
      },
      "ClassAverage": {
        "type": "object",
        "description": "班级平均成绩信息",
        "properties": {
          "className": {
            "type": "string",
            "description": "班级名称",
            "example": "计算机科学与技术2020级1班"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 80.2
          }
        }
      },
      "CourseAverage": {
        "type": "object", 
        "description": "课程平均成绩信息",
        "properties": {
          "courseId": {
            "type": "string",
            "description": "课程ID",
            "example": "CS301"
          },
          "courseName": {
            "type": "string",
            "description": "课程名称",
            "example": "计算机网络"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 84.5
          }
        }
      },
      "YearlyTrend": {
        "type": "object",
        "description": "年度成绩趋势",
        "properties": {
          "year": {
            "type": "string",
            "description": "学年",
            "example": "2020-2021"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 82.6
          }
        }
      },
      "DashboardStats": {
        "type": "object",
        "description": "Dashboard统计数据",
        "properties": {
          "studentCount": {
            "type": "integer",
            "description": "学生总数",
            "example": 1500
          },
          "courseCount": {
            "type": "integer",
            "description": "课程总数",
            "example": 120
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 82.6
          }
        }
      },
      "StudentStats": {
        "type": "object",
        "description": "学生统计数据",
        "properties": {
          "studentId": {
            "type": "string",
            "description": "学生ID",
            "example": "2020XXXX"
          },
          "studentName": {
            "type": "string",
            "description": "学生姓名",
            "example": "张三"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 85.5
          },
          "courseScores": {
            "type": "array",
            "description": "课程成绩列表",
            "items": {
              "$ref": "#/components/schemas/CourseScore"
            }
          },
          "totalCourses": {
            "type": "integer",
            "description": "总课程数",
            "example": 10
          },
          "scoreDistribution": {
            "$ref": "#/components/schemas/ScoreDistribution"
          }
        }
      },
      "ClassStats": {
        "type": "object",
        "description": "班级统计数据",
        "properties": {
          "className": {
            "type": "string",
            "description": "班级名称",
            "example": "计算机科学与技术2020级1班"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 83.2
          },
          "studentCount": {
            "type": "integer",
            "description": "学生人数",
            "example": 40
          },
          "topStudents": {
            "type": "array",
            "description": "成绩最好的学生",
            "items": {
              "$ref": "#/components/schemas/StudentBrief"
            }
          },
          "courseAverages": {
            "type": "array",
            "description": "各课程平均成绩",
            "items": {
              "$ref": "#/components/schemas/CourseAverage"
            }
          },
          "scoreDistribution": {
            "$ref": "#/components/schemas/ScoreDistribution"
          }
        }
      },
      "CourseStats": {
        "type": "object",
        "description": "课程统计数据",
        "properties": {
          "courseId": {
            "type": "string",
            "description": "课程ID",
            "example": "CS201"
          },
          "courseName": {
            "type": "string",
            "description": "课程名称",
            "example": "数据结构"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 78.6
          },
          "studentCount": {
            "type": "integer",
            "description": "选课学生数",
            "example": 120
          },
          "teacherName": {
            "type": "string",
            "description": "任课教师",
            "example": "赵教授"
          },
          "highestScore": {
            "type": "number",
            "format": "float",
            "description": "最高分",
            "example": 98
          },
          "lowestScore": {
            "type": "number",
            "format": "float",
            "description": "最低分",
            "example": 45
          },
          "passingRate": {
            "type": "number",
            "format": "float",
            "description": "及格率(%)",
            "example": 92.5
          },
          "classAverages": {
            "type": "array",
            "description": "各班级平均成绩",
            "items": {
              "$ref": "#/components/schemas/ClassAverage"
            }
          },
          "scoreDistribution": {
            "$ref": "#/components/schemas/ScoreDistribution"
          }
        }
      },
      "StudentListItem": {
        "type": "object",
        "description": "学生列表项",
        "properties": {
          "studentId": {
            "type": "string",
            "description": "学生ID",
            "example": "2020XXXX"
          },
          "studentName": {
            "type": "string",
            "description": "学生姓名",
            "example": "张三"
          },
          "className": {
            "type": "string",
            "description": "班级名称",
            "example": "计算机科学与技术2020级1班"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 88.5
          }
        }
      },
      "AllStudentsStats": {
        "type": "object",
        "description": "所有学生统计数据",
        "properties": {
          "total": {
            "type": "integer",
            "description": "总学生数",
            "example": 1500
          },
          "page": {
            "type": "integer",
            "description": "当前页码",
            "example": 1
          },
          "pageSize": {
            "type": "integer",
            "description": "每页数量",
            "example": 10
          },
          "students": {
            "type": "array",
            "description": "学生列表",
            "items": {
              "$ref": "#/components/schemas/StudentListItem"
            }
          },
          "schoolAverageScore": {
            "type": "number",
            "format": "float",
            "description": "全校平均分",
            "example": 82.6
          },
          "scoreDistribution": {
            "$ref": "#/components/schemas/ScoreDistribution"
          }
        }
      },
      "CourseStatItem": {
        "type": "object",
        "description": "课程统计项",
        "properties": {
          "courseId": {
            "type": "string",
            "description": "课程ID",
            "example": "CS401"
          },
          "courseName": {
            "type": "string",
            "description": "课程名称",
            "example": "软件工程"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 89.3
          }
        }
      },
      "ClassStatItem": {
        "type": "object",
        "description": "班级统计项",
        "properties": {
          "className": {
            "type": "string",
            "description": "班级名称",
            "example": "软件工程2019级3班"
          },
          "averageScore": {
            "type": "number",
            "format": "float",
            "description": "平均成绩",
            "example": 87.2
          }
        }
      },
      "AllStatistics": {
        "type": "object",
        "description": "所有统计数据",
        "properties": {
          "studentCount": {
            "type": "integer",
            "description": "学生总数",
            "example": 1500
          },
          "courseCount": {
            "type": "integer",
            "description": "课程总数",
            "example": 120
          },
          "teacherCount": {
            "type": "integer",
            "description": "教师总数",
            "example": 80
          },
          "classCount": {
            "type": "integer",
            "description": "班级总数",
            "example": 40
          },
          "overallAverageScore": {
            "type": "number",
            "format": "float",
            "description": "整体平均成绩",
            "example": 82.6
          },
          "courseStatistics": {
            "type": "object",
            "description": "课程统计",
            "properties": {
              "highestAverageCourse": {
                "$ref": "#/components/schemas/CourseStatItem"
              },
              "lowestAverageCourse": {
                "$ref": "#/components/schemas/CourseStatItem"
              }
            }
          },
          "classStatistics": {
            "type": "object",
            "description": "班级统计",
            "properties": {
              "highestAverageClass": {
                "$ref": "#/components/schemas/ClassStatItem"
              },
              "lowestAverageClass": {
                "$ref": "#/components/schemas/ClassStatItem"
              }
            }
          },
          "scoreDistribution": {
            "$ref": "#/components/schemas/ScoreDistribution"
          },
          "yearlyTrend": {
            "type": "array",
            "description": "年度成绩趋势",
            "items": {
              "$ref": "#/components/schemas/YearlyTrend"
            }
          }
        }
      }
    }
  }
}
